<!DOCTYPE html>
<html>
<head>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="/js/application.js"></script>
</head>
<body>
  <a id='home' href="/">home</a>
  <h1>My First Google Map</h1>

  <div id="googleMap" style="width:100%;height:600px;"></div>
  <div id="form">
    <form method='post' action='/photos'>
      <input type='hidden' value = '<%= current_user.id %>' name='photo[user_id]'/>
      <input type='hidden' value = '<%= @location.id %>' name='photo[location_id]'/>
      <input type='hidden' value = '<%= @location.id %>' name='photo[location_id]'/>
      <input type='hidden' value = '<%= @location.id %>' name='photo[location_id]'/>
      Description:<input type='text' name='photo[description]'/>
      Photo URL:<input type='text' name='photo[photo]'/>
      <input type='submit' value='Save'/>
    </form>
  </div>
  <!-- <div id="message">Location saved</div> -->

  <script>
   var map;
   var marker;
   var infowindow;
   var messagewindow;

  $(document).ready(function() {
    addCoordinatesToPhotoForm()
  })


  function addCoordinatesToPhotoForm(){
    var firstClick = true;
    $(document).on('click', function(event) {
      if (firstClick == true) {
        firstClick = false
        event.preventDefault();
        var latlng = marker.position;
        console.log(latlng)
      }
    })
  }

   function myMap() {
    var mapProp= {
      center:new google.maps.LatLng(37.891716, -122.323511),
      zoom:19,
      mapTypeId: 'satellite'
    };

    function saveData() {
      var user_name = escape(document.getElementById('name').value);
      var description = escape(document.getElementById('description').value);
      // var type = document.getElementById('type').value;
      var latlng = marker.getPosition();
      var url = escape(document.getElementById('photo_url').value);

    }

    var map=new google.maps.Map(document.getElementById("googleMap"),mapProp);
    // this is for creating existing markers
    // var uluru = {lat: 37.890116, lng: -122.324145};
    // var marker = new google.maps.Marker({
    //   position: uluru,
    //   map: map
    // });
    infowindow = new google.maps.InfoWindow({
      content: document.getElementById('form')
    })

    messagewindow = new google.maps.InfoWindow({
      content: document.getElementById('message')
    });

    google.maps.event.addListener(map, 'click', function(event) {
      marker = new google.maps.Marker({
        position: event.latLng,
        map: map
      });


      google.maps.event.addListener(marker, 'click', function() {
        infowindow.open(map, marker);
      });
    });
  }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['KEY'] %>&callback=myMap"></script>

</body>
</html>
